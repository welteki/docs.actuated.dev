
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Realise the potential of blazingly fast builds.">
      
      
        <meta name="author" content="OpenFaaS Ltd">
      
      
        <link rel="canonical" href="https://docs.actuated.dev/expose-agent/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Expose agent - Actuated</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto,+Helvetica:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto, Helvetica";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-PTK21TFJ7V"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-PTK21TFJ7V",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-PTK21TFJ7V",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#expose-the-agents-api-over-https" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Actuated" class="md-header__button md-logo" aria-label="Actuated" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Actuated
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Expose agent
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/self-actuated" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    self-actuated/actuated
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Actuated" class="md-nav__button md-logo" aria-label="Actuated" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    Actuated
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/self-actuated" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    self-actuated/actuated
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" tabindex="0" aria-expanded="false">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard/" class="md-nav__link">
        Dashboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contact/" class="md-nav__link">
        Contact us
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          Onboarding
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Onboarding" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Onboarding
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../register/" class="md-nav__link">
        Register your GitHub Organisation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../provision-server/" class="md-nav__link">
        Provision a Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-agent/" class="md-nav__link">
        Install the Agent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../test-build/" class="md-nav__link">
        Run a test build
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Tasks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tasks" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tasks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/registry-mirror/" class="md-nav__link">
        Setup a Registry Mirror
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/debug-ssh/" class="md-nav__link">
        Debug a job with SSH
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/cli/" class="md-nav__link">
        Set-up the CLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/local-github-cache/" class="md-nav__link">
        Setup self-hosted cache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/monitoring/" class="md-nav__link">
        Monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/system-info/" class="md-nav__link">
        System Info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/matrix/" class="md-nav__link">
        Job Matrix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/kernel/" class="md-nav__link">
        Compile a Kernel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/k3s/" class="md-nav__link">
        Kubernetes with K3s
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/kind/" class="md-nav__link">
        Kubernetes with KinD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/matrix-k8s/" class="md-nav__link">
        Kubernetes regression matrix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/docker/" class="md-nav__link">
        Docker run/build
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/openfaas-publish/" class="md-nav__link">
        Publish an OpenFaaS function
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/openfaas-helm/" class="md-nav__link">
        Deploy a Helm chart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/custom-vm-size/" class="md-nav__link">
        Custom VM sizes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/github-actions-cache/" class="md-nav__link">
        Using caching in builds
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          Advanced examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Advanced examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/kvm-guest/" class="md-nav__link">
        Run a KVM guest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/multiarch-buildx/" class="md-nav__link">
        Multi-arch images with buildx
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#expose-the-agents-api-over-https" class="md-nav__link">
    Expose the agent's API over HTTPS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-a-host-on-a-public-cloud" class="md-nav__link">
    For a host on a public cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-hosts-on-premises-behind-nat-or-at-home" class="md-nav__link">
    Private hosts - on-premises, behind NAT or at home
  </a>
  
    <nav class="md-nav" aria-label="Private hosts - on-premises, behind NAT or at home">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preventing-the-runner-from-accessing-your-local-network" class="md-nav__link">
    Preventing the runner from accessing your local network
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Expose agent</h1>

<h2 id="expose-the-agents-api-over-https">Expose the agent's API over HTTPS<a class="headerlink" href="#expose-the-agents-api-over-https" title="Permanent link">&para;</a></h2>
<p>The actuated agent serves HTTP, and must be accessible by the actuated control plane.</p>
<p>We expect most of our customers to be using hosts with public IP addresses, and the combination of an API token plus TLS is a battle tested combination.</p>
<p>For anyone running with private hosts, OpenFaaS Ltd's inlets product can be used to get incoming traffic over a secure tunnel</p>
<h2 id="for-a-host-on-a-public-cloud">For a host on a public cloud<a class="headerlink" href="#for-a-host-on-a-public-cloud" title="Permanent link">&para;</a></h2>
<p>If you're running the agent on a host with a public IP, you can use the built-in TLS mechanism in the actuated agent to receive a certificate from Let's Encrypt, valid for 90 days. The certificate will be renewed by the actuated agent, so there are no additional administration tasks required.</p>
<p><img alt="Accessing the agent's endpoint built-in TLS and Let's Encrypt" src="../images/builtin-tls.png" /></p>
<blockquote>
<p>Pictured: Accessing the agent's endpoint built-in TLS and Let's Encrypt</p>
</blockquote>
<p>Determine the public IP of your instance:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># curl -s http://checkip.amazonaws.com</span>

<span class="m">141</span>.73.80.100
</code></pre></div>
<p>Now imagine that your sub-domain is <code>agent.example.com</code>, you need to create a DNS A record of <code>agent.example.com=141.73.80.100</code>, changing both the sub-domain and IP to your own.</p>
<p>Once the agent is installed, edit /etc/default/actuated on the agent and set the following two variables:</p>
<div class="highlight"><pre><span></span><code>AGENT_LETSENCRYPT_DOMAIN=&quot;agent.example.com&quot;
AGENT_LETSENCRYPT_EMAIL=&quot;webmaster@agent.example.com&quot;
</code></pre></div>
<p>Restart the agent:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>actuated
</code></pre></div>
<p>Your agent's endpoint URL is going to be: <code>https://agent.example.com</code> on port 443</p>
<h2 id="private-hosts-on-premises-behind-nat-or-at-home">Private hosts - on-premises, behind NAT or at home<a class="headerlink" href="#private-hosts-on-premises-behind-nat-or-at-home" title="Permanent link">&para;</a></h2>
<p>You'll need a way to expose the client to the Internet, which includes HTTPS encryption and a sufficient amount of connections/traffic per minute.</p>
<p><a href="https://inlets.dev/">Inlets</a> provides a quick and secure solution here. It is available on a <a href="https://inlets.dev/pricing">monthly subscription</a>, bear in mind that the "Personal" plan is not for this kind of commercial use.</p>
<p><img alt="Accessing the agent's private endpoint using an inlets-pro tunnel" src="../images/tunnel-server.png" /></p>
<blockquote>
<p>Pictured: Accessing the agent's private endpoint using an inlets-pro tunnel</p>
</blockquote>
<p>Reach out to us if you'd like us to host a tunnel server for you, alternatively, you can follow the instructions below to set up your own.</p>
<p>The <a href="https://github.com/inlets/inletsctl">inletsctl</a> tool will create a HTTPS tunnel server with you on your favourite cloud with a HTTPS certificate obtained from Let's Encrypt.</p>
<p>If you have just the one Actuated Agent:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AGENT_DOMAIN</span><span class="o">=</span>agent1.example.com
<span class="nb">export</span><span class="w"> </span><span class="nv">LE_EMAIL</span><span class="o">=</span>webmaster@agent1.example.com

arkade<span class="w"> </span>get<span class="w"> </span>inletsctl
sudo<span class="w"> </span>mv<span class="w"> </span><span class="nv">$HOME</span>/.arkade/bin/inletsctl<span class="w"> </span>/usr/local/bin/

inletsctl<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--provider<span class="w"> </span>digitalocean<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--region<span class="w"> </span>lon1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--token-file<span class="w"> </span><span class="nv">$HOME</span>/do-token<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--letsencrypt-email<span class="w"> </span><span class="nv">$LE_EMAIL</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--letsencrypt-domain<span class="w"> </span><span class="nv">$AGENT_DOMAIN</span>
</code></pre></div>
<p>Then note down the tunnel's wss:// URL and token.</p>
<p>Then run a HTTPS client to expose your agent:</p>
<div class="highlight"><pre><span></span><code>inlets-pro<span class="w"> </span>http<span class="w"> </span>client<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--url<span class="w"> </span><span class="nv">$WSS_URL</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--token<span class="w"> </span><span class="nv">$TOKEN</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--upstream<span class="w"> </span>http://127.0.0.1:8081
</code></pre></div>
<p>For two or more Actuated Servers:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AGENT_DOMAIN1</span><span class="o">=</span>agent1.example.com
<span class="nb">export</span><span class="w"> </span><span class="nv">AGENT_DOMAIN2</span><span class="o">=</span>agent2.example.com
<span class="nb">export</span><span class="w"> </span><span class="nv">LE_EMAIL</span><span class="o">=</span>webmaster@agent1.example.com

arkade<span class="w"> </span>get<span class="w"> </span>inletsctl
sudo<span class="w"> </span>mv<span class="w"> </span><span class="nv">$HOME</span>/.arkade/bin/inletsctl<span class="w"> </span>/usr/local/bin/

inletsctl<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--provider<span class="w"> </span>digitalocean<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--region<span class="w"> </span>lon1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--token-file<span class="w"> </span><span class="nv">$HOME</span>/do-token<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--letsencrypt-email<span class="w"> </span><span class="nv">$LE_EMAIL</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--letsencrypt-domain<span class="w"> </span><span class="nv">$AGENT_DOMAIN1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--letsencrypt-domain<span class="w"> </span><span class="nv">$AGENT_DOMAIN2</span>
</code></pre></div>
<p>Then note down the tunnel's wss:// URL and token.</p>
<p>Then run a HTTPS client to expose your agent, using the unique agent domain, run the inlets-pro client on the Actuated Servers:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AGENT_DOMAIN1</span><span class="o">=</span>agent1.example.com
inlets-pro<span class="w"> </span>http<span class="w"> </span>client<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--url<span class="w"> </span><span class="nv">$WSS_URL</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--token<span class="w"> </span><span class="nv">$TOKEN</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--upstream<span class="w"> </span><span class="nv">$AGENT1_DOMAIN</span><span class="o">=</span>http://127.0.0.1:8081
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AGENT_DOMAIN2</span><span class="o">=</span>agent2.example.com
inlets-pro<span class="w"> </span>http<span class="w"> </span>client<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--url<span class="w"> </span><span class="nv">$WSS_URL</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--token<span class="w"> </span><span class="nv">$TOKEN</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--upstream<span class="w"> </span><span class="nv">$AGENT1_DOMAIN</span><span class="o">=</span>http://127.0.0.1:8081
</code></pre></div>
<p>You can generate a systemd service (so that inlets restarts upon disconnection, and reboot) by adding <code>--generate=systemd &gt; inlets.service</code> and running:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cp<span class="w"> </span>inlets.service<span class="w"> </span>/etc/systemd/system/
sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>inlets.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>inlets

<span class="c1"># Check status with:</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>inlets
</code></pre></div>
<p>Your agent's endpoint URL is going to be: <code>https://$AGENT_DOMAIN</code>.</p>
<h3 id="preventing-the-runner-from-accessing-your-local-network">Preventing the runner from accessing your local network<a class="headerlink" href="#preventing-the-runner-from-accessing-your-local-network" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Network segmentation</p>
<p>Proper network segmentation of hosts running the actuated agent is required. This is to prevent runners from making outbound connections to other hosts on your local network. We will not accept any responsibility for your configuration.</p>
</div>
<p>If hardware isolation is not available, iptables rules may provide an alternative for isolating the runners from your network.</p>
<p>Imagine you were using a LAN range of <code>192.168.0.0/24</code>, with a router of <code>192.168.0.1</code>, then the following probes and tests show that the runner cannot access the host 192.168.0.101, and that nmap's scan will come up dry.</p>
<p>We add a rule to allow access to the router, but reject packets going via TCP or UDP to any other hosts on the network.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>iptables<span class="w"> </span>--insert<span class="w"> </span>CNI-ADMIN<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--destination<span class="w">  </span><span class="m">192</span>.168.0.1<span class="w"> </span>--jump<span class="w"> </span>ACCEPT
sudo<span class="w"> </span>iptables<span class="w"> </span>--insert<span class="w"> </span>CNI-ADMIN<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--destination<span class="w">  </span><span class="m">192</span>.168.0.0/24<span class="w"> </span>--jump<span class="w"> </span>REJECT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w">  </span>--reject-with<span class="w"> </span>tcp-reset
sudo<span class="w"> </span>iptables<span class="w"> </span>--insert<span class="w"> </span>CNI-ADMIN<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--destination<span class="w">  </span><span class="m">192</span>.168.0.0/24<span class="w"> </span>--jump<span class="w"> </span>REJECT<span class="w"> </span>-p<span class="w"> </span>udp<span class="w"> </span>--reject-with<span class="w"> </span>icmp-port-unreachable
</code></pre></div>
<p>You can test the efficacy of these rules by running nmap, mtr, ping and any other probing utilities within a GitHub workflow.</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CI</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">specs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">specs</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actuated</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">addr</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip addr</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">route</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ip route</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pkgs</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">             </span><span class="no">sudo apt-get update &amp;&amp; \</span>
<span class="w">              </span><span class="no">sudo apt-get install traceroute mtr nmap netcat -qy</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traceroute</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traceroute  192.168.0.101</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Connect to ssh</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo | nc  192.168.0.101 22</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mtr</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mtr -rw  -c 1  192.168.0.101</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nmap for SSH</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nmap -p 22  192.168.0.0/24</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ping router</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">ping -c 1  192.168.0.1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ping 101</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">ping -c 1  192.168.0.101</span>
</code></pre></div>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 OpenFaaS Ltd

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand"], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>